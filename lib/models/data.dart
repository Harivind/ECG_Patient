import 'dart:io';
import 'dart:math';

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:fl_chart/fl_chart.dart';
import 'package:flutter/foundation.dart';

class Data extends ChangeNotifier {
  int i = 371;
  FirebaseUser currentUser;
  List patients = [];
  dynamic currentPatient;
  List<FlSpot> ecgGraph = [
    FlSpot(0, 120),
    FlSpot(1, 160),
    FlSpot(2, 60),
    FlSpot(3, 120),
    FlSpot(4, 100),
    FlSpot(5, 80),
    FlSpot(6, 150),
    FlSpot(7, 150),
    FlSpot(8, 100),
  ];
  static Map<String, List<List<List<double>>>> data = {
    "data": [
      [
        [-0.663191447337924],
        [-0.6620534959432886],
        [-0.650125369208059],
        [-0.6296053902984122],
        [-0.6038503881641961],
        [-0.576895273430185],
        [-0.5528793788217563],
        [-0.5354615539644937],
        [-0.5273072789704072],
        [-0.5297203313932239],
        [-0.5424704089669402],
        [-0.5638396880529343],
        [-0.5908797458102293],
        [-0.6198401888233136],
        [-0.6467060681351733],
        [-0.6677661989549013],
        [-0.6801309392353493],
        [-0.6821262305232211],
        [-0.6735094524430761],
        [-0.6554790500855653],
        [-0.6304800277166467],
        [-0.601836821904746],
        [-0.5732694830810163],
        [-0.5483649996428643],
        [-0.5300807780257775],
        [-0.5203511369400482],
        [-0.5198512547340823],
        [-0.5279488985625161],
        [-0.5428461395599407],
        [-0.5618853413589406],
        [-0.5819701322126176],
        [-0.6000362614320468],
        [-0.6135014189851278],
        [-0.6206279583376935],
        [-0.6207470923988522],
        [-0.6143151636987557],
        [-0.6027985773942359],
        [-0.5884099386789317],
        [-0.5737399281607016],
        [-0.5613442110131381],
        [-0.5533500851395666],
        [-0.5511429620140471],
        [-0.5551790129927594],
        [-0.5649496650302381],
        [-0.579099382846507],
        [-0.5956741332320847],
        [-0.6124578190515632],
        [-0.6273408741877391],
        [-0.6386610861622705],
        [-0.6454621076677829],
        [-0.647629091340546],
        [-0.6458811609286254],
        [-0.6416237715475637],
        [-0.6366867040546115],
        [-0.6329918922481965],
        [-0.6322065814796812],
        [-0.6354396786023983],
        [-0.6430321997918232],
        [-0.654477546369822],
        [-0.6684863302137355],
        [-0.6831869485777284],
        [-0.6964308039283855],
        [-0.7061535381257416],
        [-0.7107337340627661],
        [-0.7092898878994756],
        [-0.7018652841353181],
        [-0.6894674384190628],
        [-0.6739514308923147],
        [-0.6577612439908262],
        [-0.6435662711967118],
        [-0.633847823251264],
        [-0.6304998593416572],
        [-0.6345076878764367],
        [-0.6457578989220277],
        [-0.6630137399314394],
        [-0.6840653083351066],
        [-0.7060370295436466],
        [-0.7258100208798733],
        [-0.740497975550109],
        [-0.7479051673674896],
        [-0.7468958000265865],
        [-0.7376153378426444],
        [-0.7215251570748042],
        [-0.7012389150741529],
        [-0.6801785042550706],
        [-0.6620949627813902],
        [-0.6505210963185011],
        [-0.6482345129174455],
        [-0.6568103262922523],
        [-0.6763316452469293],
        [-0.7053045726233131],
        [-0.7407957592055292],
        [-0.7787786880117307],
        [-0.8146444203777031],
        [-0.8438079864382233],
        [-0.8623266098271425],
        [-0.8674428258232961],
        [-0.8579748842692035],
        [-0.8344974153560377],
        [-0.7992843232745076],
        [-0.7560191632642034],
        [-0.709311101948812],
        [-0.6640822431048106],
        [-0.624910624324867],
        [-0.5954198593232308],
        [-0.577800217202913],
        [-0.572527740019318],
        [-0.5783203747084861],
        [-0.5923369607819337],
        [-0.6105909844762794],
        [-0.6285211033206707],
        [-0.6416387941482934],
        [-0.6461631183214506],
        [-0.639554938249632],
        [-0.6208775448243673],
        [-0.5909354004950674],
        [-0.5521739745396305],
        [-0.5083569543640797],
        [-0.46406772435117905],
        [-0.42410561725345924],
        [-0.39286082181134974],
        [-0.3737532416787499],
        [-0.3688100501759871],
        [-0.37843589019246276],
        [-0.40140178342634836],
        [-0.43504794994491014],
        [-0.4756663541770226],
        [-0.5190050346025948],
        [-0.560821383473346],
        [-0.5974074022494511],
        [-0.6260168453769044],
        [-0.645140747509873],
        [-0.6546013994466452],
        [-0.6554617448591129],
        [-0.6497733827975536],
        [-0.6402080779159816],
        [-0.6296318882711366],
        [-0.6206859244356708],
        [-0.6154330124216078],
        [-0.6151162693117664],
        [-0.6200561882573202],
        [-0.6296904939672637],
        [-0.6427393269672081],
        [-0.6574605710526006],
        [-0.6719489379329504],
        [-0.6844292232651487],
        [-0.6934990788050645],
        [-0.6982885219384577],
        [-0.6985199502975745],
        [-0.6944706710937463],
        [-0.6868567196993934],
        [-0.676669185764512],
        [-0.6650003400978866],
        [-0.6528956453042329],
        [-0.6412596004382543],
        [-0.630829893290598],
        [-0.6222180432429789],
        [-0.6159986699241513],
        [-0.6128167860089095],
        [-0.6134756395427737],
        [-0.6189682108231284],
        [-0.6304238256406587],
        [-0.6489564425026116],
        [-0.67542072864328],
        [-0.7101028707520641],
        [-0.7523915633953481],
        [-0.800487327293493],
        [-0.8512125032458187],
        [-0.8999784226158273],
        [-0.9409503612570755],
        [-0.9674265255193991],
        [-0.9724175159705111],
        [-0.9493815321535654],
        [-0.8930425676589419],
        [-0.8001983693658515],
        [-0.6704155324444903],
        [-0.5065129129913699],
        [-0.3147519330589523],
        [-0.10468180039661001],
        [0.11137411629094238],
        [0.3191621667463015],
        [0.5036028767344808],
        [0.6500519016805131],
        [0.7455903668964183],
        [0.780209149844227],
        [0.747759467181814],
        [0.6465654358901238],
        [0.4796304045616147],
        [0.25441342153928487],
        [-0.017800278580424416],
        [-0.32286632177854296],
        [-0.6449812072742228],
        [-0.9679874231757575],
        [-1.2766480096555501],
        [-1.5577632671564554],
        [-1.8010253553269613],
        [-1.9995409574297602],
        [-2.149993297284805],
        [-2.2524571722856694],
        [-2.3099189133540925],
        [-2.32758266000536],
        [-2.3120617617795634],
        [-2.270557957733122],
        [-2.2101216130649175],
        [-2.137065845194798],
        [-2.0565793848089404],
        [-1.972551860460736],
        [-1.8875954154578538],
        [-1.8032222280769352],
        [-1.7201216297621216],
        [-1.638474685564078],
        [-1.558248305814891],
        [-1.4794236748004561],
        [-1.402132283198747],
        [-1.3266936824830386],
        [-1.2535686333482912],
        [-1.183256409164675],
        [-1.1161733619567051],
        [-1.0525504245638395],
        [-0.9923803332215823],
        [-0.9354325987802533],
        [-0.8813381855985509],
        [-0.8297295430226961],
        [-0.7804081326903218],
        [-0.7335034359844439],
        [-0.6895861888163026],
        [-0.6497046386712778],
        [-0.615325035573612],
        [-0.5881743070928724],
        [-0.570001084017723],
        [-0.5622877657602174],
        [-0.5659581688629641],
        [-0.5811302124125232],
        [-0.6069598766851915],
        [-0.6416114559205379],
        [-0.6823713701476102],
        [-0.7259010890636817],
        [-0.7686023795024509],
        [-0.8070486730557779],
        [-0.8384230872756173],
        [-0.8608988962373817],
        [-0.8739031567626274],
        [-0.8782184140088125],
        [-0.8758991392690197],
        [-0.8700057803223162],
        [-0.8641862282243513],
        [-0.8621580931567325],
        [-0.867161784483808],
        [-0.8814612982815031],
        [-0.9059654968790373],
        [-0.9400277963187589],
        [-0.9814584410738331],
        [-1.0267541823834478],
        [-1.0715193345007885],
        [-1.1110243180561996],
        [-1.1408270231650204],
        [-1.1573717912638721],
        [-1.1584822410130673],
        [-1.14367755505781],
        [-1.1142654683267375],
        [-1.0731958141503037],
        [-1.024691797100959],
        [-0.9737074360054497],
        [-0.9252843657843417],
        [-0.8838958098594863],
        [-0.85286787025356],
        [-0.8339579159918248],
        [-0.8271481900673042],
        [-0.8306828371487721],
        [-0.8413426104372363],
        [-0.8549183669143258],
        [-0.8668168193147437],
        [-0.8727138066794017],
        [-0.869164144894548],
        [-0.8540837706671521],
        [-0.827038398556207],
        [-0.7893005761988027],
        [-0.7436698511804382],
        [-0.694084038459612],
        [-0.6450785503149398],
        [-0.6011713251512788],
        [-0.5662602128471835],
        [-0.5431165347831962],
        [-0.5330435368862863],
        [-0.5357439002242058],
        [-0.5494100267189179],
        [-0.5710189466777724],
        [-0.596785018083598],
        [-0.6227021963537052],
        [-0.645096520800347],
        [-0.6611100239852423],
        [-0.6690492262121952],
        [-0.6685527695773797],
        [-0.6605602617706242],
        [-0.6470938813915859],
        [-0.6308913671654305],
        [-0.6149497285798659],
        [-0.6020504416846221],
        [-0.5943375299039096],
        [-0.5930099090052894],
        [-0.5981704210794186],
        [-0.6088491256752084],
        [-0.6231915215367949],
        [-0.6387775434674557],
        [-0.6530181362068525],
        [-0.6635657310031728],
        [-0.6686744724405973],
        [-0.6674554472387061],
        [-0.6599898282538191],
        [-0.6472858993239864],
        [-0.6310907159504712],
        [-0.6135898113744596],
        [-0.5970453854734494],
        [-0.5834322368831667],
        [-0.5741300414587921],
        [-0.569720655635318],
        [-0.569921587805931],
        [-0.5736644668074871],
        [-0.5793038046200821],
        [-0.5849203313977244],
        [-0.5886679941158047],
        [-0.5891067465202457],
        [-0.5854656096181637],
        [-0.5777917726686029],
        [-0.5669599499468031],
        [-0.5545388934956854],
        [-0.54253529531821],
        [-0.5330555862101102],
        [-0.5279401077534474],
        [-0.5284295260858469],
        [-0.5349192305517563],
        [-0.5468443644274502],
        [-0.5627180285716451],
        [-0.5803211606111117],
        [-0.597018349750182],
        [-0.6101532039498007],
        [-0.617463131887898],
        [-0.6174487979519924],
        [-0.6096389260727225],
        [-0.5947058991147365],
        [-0.5744096015434308],
        [-0.5513729152442823],
        [-0.5287182749841236],
        [-0.5096167301928493],
        [-0.4968155980408054],
        [-0.4922156619547683],
        [-0.4965630550402844],
        [-0.5093051646272448],
        [-0.5286363223594239],
        [-0.5517311315478373],
        [-0.5751351619893761],
        [-0.5952586338697136],
        [-0.6089022935479306],
        [-0.6137385279147092],
        [-0.6086759411868152],
        [-0.5940515197345476],
        [-0.5716189219535427],
        [-0.5443308443245716],
        [-0.5159435424780655],
        [-0.4904979867280953],
        [-0.47175087160480594],
        [-0.46263693975881576],
        [-0.46484050788253584],
        [-0.4785391118492809],
        [-0.5023579167902337],
        [-0.5335434441078667],
        [-0.5683336075007619],
        [-0.602472620167473],
        [-0.6317981965188938],
        [-0.6528177361149979]
      ]
    ]
  };
  void addPoint() {
    // ecgGraph.removeAt(0);
    // ecgGraph.add(FlSpot(ecgGraph[7].x + 1, (Random().nextInt(180)).toDouble()));
    // ecgGraph = [
    //   FlSpot(0, 120),
    //   FlSpot(1, 160),
    //   FlSpot(2, 60),
    //   FlSpot(3, 120),
    //   FlSpot(4, 100),
    //   FlSpot(5, 80),
    //   FlSpot(6, 150),
    //   FlSpot(7, 150),
    //   FlSpot(8, 100),
    // ];

    data['data'].forEach((element) {
      element.forEach((element) {
        ecgGraph.removeAt(0);
        ecgGraph.add(FlSpot((i++).toDouble(), element[0]));
        notifyListeners();
        sleep(Duration(microseconds: 270));
      });
    });
    notifyListeners();
  }

  int get patientCount {
    return patients.length;
  }

  // UnmodifiableListView<dynamic> get patients {
  //   return UnmodifiableListView(patients);
  // }

  void setPatients(patients) {
    print(patients);
    this.patients = patients;
  }

  Future<void> getPatientDetails() async {
    await Firestore.instance
        .collection('patients')
        .where('uid', isEqualTo: currentUser.uid)
        .getDocuments()
        .then((value) => currentPatient = value.documents[0].data);
    notifyListeners();
  }

  void addCurrentUser(FirebaseUser user) {
    currentUser = user;
    notifyListeners();
  }

  FirebaseUser get loggedIntUser {
    return currentUser;
  }
}
